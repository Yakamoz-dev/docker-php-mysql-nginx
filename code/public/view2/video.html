<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>video.js</title>
    <link href="css/video-js.min.css" rel="stylesheet">
    <script src="js/video.min.js"></script>
    <script src="js/videojs-flash.js"></script>
    <script src="js/videojs-contrib-hls.js"></script>
	<script src="js/jquery-1.8.3.min.js"></script>
	
	<link href="css/videojs.errors.css" rel="stylesheet">
    <script src="js/videojs.errors.js"></script>
	
    <style type="text/css">
    *,body{
      padding: 0;
      margin:0;
    }
      .content{
        width: 100%;
        height: 100%;
        display: flex;
        -webkit-display:flex;
        -ms-display:flex;
		flex:7;
		-webkit-flex:7;
		-ms-flex:7;
        flex-wrap: wrap;
        
      }
      .item{        
        width: 50%;
        height: 50%;
      }
      .item .video-js{
        width: 100%;
        height: 100%
      }
	  .msg{        
        flex:2;
		-webkit-flex:2;
		-ms-flex:2;
		height:100%;
		overflow-y:scroll;
		
      }
	  .main{
		display: flex;
        -webkit-display:flex;
        -ms-display:flex;
		position: absolute;
        top: 0;
        left: 0;
		 width: 100%;
        height: 100%;
	  }
	  .msg .open{
		width:100%;
		height:50px;
		border-bottom:1px solid #eee;
		text-align:center;
		line-height:50px;
		
	  }
	  .msg .open button{
		background:blue;
		color:#fff;
		border:none;
		width:100px;
		height:30px;
		cursor:pointer
	  }
    </style>
  </head>
  <body>
  <div class="main">
	<div class="content">
		<div class="item">
			<video id="my-player" class="video-js" controls>
			  <source src="" type="rtmp/flv">
			  <p class="vjs-no-js">
				not support
			  </p>
		  </video>
		</div>
		<div class="item" >
		  <video id="my-player1" class="video-js" controls>
			  <source src="" type="rtmp/flv">
			  <p class="vjs-no-js">
				not support
			  </p>
		  </video>
		</div>
		<div class="item">
		  <video  id="my-player2" class="video-js" controls>
			  <source src="" type="rtmp/flv">
			  <p class="vjs-no-js">
				not support
			  </p>
		  </video>
		</div>
		<div class="item">
		  <video id="my-player3" class="video-js" controls>
			  <source src="" type="rtmp/flv">
			  <p class="vjs-no-js">
				not support
			  </p>
		  </video>
		</div>
	</div>
	<div class="msg" id="msg">
		<div class="open">
			<button onclick="openwebsocket()">开启监控</button>
			<button onclick="remove()">清除</button>
		</div>
        报警信息：
		<ul id="msgtable">
		
		</ul>
    </div>
	</div>
  </body>
  <script type="text/javascript">
	//$(function(){
    //    
    //});
	
	//function initData(){
	//	
	//}
	
	
	url = window.location.href;
	console.log(url)
	url = url.split("?")[1];// 截取参数	
	console.log(url)
	urls = "";
	if(typeof(url) != "undefined" && url != null){
		urls = url.split("&")// 截取多个
		console.log("===="+urls)
	}
	
	
	cam0 = "";
	if(typeof(urls[0]) != "undefined" && urls[0] != null){
		cam0 = urls[0].split("=")[1];
	}
	cam1 = "";
	if(typeof(urls[1]) != "undefined" && urls[1] != null){
		cam1 = urls[1].split("=")[1];
	}
	cam2 = "";
	if(typeof(urls[2]) != "undefined" && urls[2] != null){
		cam2 = urls[2].split("=")[1];
	}
	cam3 = "";
	if(typeof(urls[3]) != "undefined" && urls[3] != null){
		cam3 = urls[3].split("=")[1];
	}
	console.log(cam0)
	// 1号
	var player = videojs('my-player',{"autoplay": true});
	player.src(cam0);
	player.play();
	// 2号
	var player1 = videojs('my-player1',{"autoplay": true});
	player1.src(cam1);
	player1.play();
	// 3号
	var player2 = videojs('my-player2',{"autoplay": true});
	player2.src(cam2);
	player2.play();
	// 4号
	var player3 = videojs('my-player3',{"autoplay": true});
	player3.src(cam3);
	player3.play();
	
	
	function openwebsocket(){
		host = window.location.host;
		console.log("获取到host：" + host);
		msgurl = "ws://"+host+":5678/";
		console.log("拼接后websocket地址："+msgurl);
		var ws = new WebSocket('ws://127.0.0.1:5678'),
		messages = document.createElement('ul');
		console.log("创建信息ul："+messages)
		ws.onmessage = function (event) {
        //var messages = document.getElementsByTagName('ul')[0],
         var message = document.createElement('li'),
        content = document.createTextNode(event.data);
		//console.log(messages+"---"+message)
        message.prepend(content);
        messages.prepend(message);
		//console.log("1111"+messages.innerHTML)
        };
		//console.log("信息节点"+document.getElementById("msgtable"))
		var msgtable = document.getElementById("msgtable");
		console.log("msgtable",msgtable)
		msgtable.prepend(messages);
	}
	function remove(){
		var msgtable = document.getElementById("msgtable");
		$("#msgtable").children().children("li").remove();
	}
	
    </script>
</html>